# Burp AI Fuzzer 实施计划

## 阶段 1：项目初始化与环境搭建
### 步骤 1.1：初始化 Maven 项目
- **指令**：创建一个基于 Maven 的 Java 17 项目，配置 `pom.xml` 引入 Burp Montoya API 依赖及相关构建插件。
- **验证**：运行 `mvn clean package`，确保构建成功且无依赖报错。

### 步骤 1.2：定义插件入口类
- **指令**：创建实现 `BurpExtension` 接口的主类，在 `initialize` 方法中注册插件名称并输出启动日志。
- **验证**：将生成的 JAR 包加载到 Burp Suite，在 "Extender" -> "Output" 标签页中看到插件启动成功的日志。

---

## 阶段 2：UI 基础架构建设
### 步骤 2.1：创建主 Tab 界面
- **指令**：使用 Swing 创建一个名为 "AI Fuzzer" 的主标签页，包含顶部的配置区域和底部的结果显示区域。
- **验证**：加载插件后，Burp 顶部菜单栏出现 "AI Fuzzer" 标签，点击可看到预设的布局。

### 步骤 2.2：配置面板开发
- **指令**：在配置区域添加文本框（API Key、Base URL）、下拉框（模型选择）和保存按钮。使用 Burp 的 `Preferences` API 将配置保存到全局设置中。
- **验证**：在文本框输入内容并点击保存，重启 Burp 或重新加载插件后，配置内容能够正确加载（跨项目持久化验证）。

---

## 阶段 3：请求上下文解析模块
### 步骤 3.1：注册右键上下文菜单
- **指令**：实现 `ContextMenuItemsProvider`，在 Proxy 或 Repeater 的右键菜单中添加 "Send to AI Fuzzer" 选项。
- **验证**：在任意 HTTP 请求上点击右键，确认菜单项存在并能获取当前选中的请求对象。

### 步骤 3.2：请求数据提取器
- **指令**：编写逻辑解析选中请求的 URL、Method、Header 以及 Body 参数（支持 JSON 和 Form 格式）。
- **验证**：点击右键菜单后，插件控制台输出解析后的请求结构化数据，确保与原请求一致。

---

## 阶段 4：AI 交互逻辑集成
### 步骤 4.1：构建 AI 提示词模板
- **指令**：设计针对不同接口场景的 Prompt 模板，在 Prompt 中严格约束 AI 仅输出 Payload 列表，每行一个，严禁输出任何解释性文字。
- **验证**：通过单元测试模拟请求数据，验证生成的 Prompt 是否包含严格的格式约束指令。

### 步骤 4.2：实现 AI 客户端通信
- **指令**：针对 OpenAI 和 Claude 分别开发独立的调用逻辑模块。使用 OkHttp 实现异步通信，解析并清洗响应数据，确保只保留 Payload。
- **验证**：配置真实的 API Key，触发调用并确认插件界面显示的列表完全由 Payload 组成，无杂质。

---

## 5. Fuzz 引擎核心逻辑
### 5.1：Payload 标记与替换逻辑
- **指令**：在 HTTP 编辑器中实现基于字符标记的识别逻辑（使用 `§` 作为定界符，如 `§value§`）。编写替换引擎，将标记位替换为字典中的值。
- **验证**：在请求文本中手动插入 `§` 标记，运行测试逻辑，确认生成的请求中 `§...§` 部分被正确替换。

### 5.2：并发请求执行器
- **指令**：实现多线程执行器，设定合理的默认并发值（如 5 线程，0 延迟）。按顺序发送替换后的 Fuzz 请求。
- **验证**：设置 10 个 Payload，启动 Fuzz，在 Burp 的 "Logger" 标签页中确认发出了 10 个对应的请求，且并发数符合预期。

---

## 6. 结果分析与展示
### 6.1：结果表格实时更新
- **指令**：将 Fuzz 请求的响应状态码、响应长度、时间等信息实时填充到主界面的表格中。
- **验证**：Fuzz 过程中，表格自动滚动并显示每一项任务的实时结果。

### 6.2：基准对比过滤
- **指令**：实现基准测试（Baseline）对比逻辑，自动高亮显示与原始响应长度或状态码不同的项。
- **验证**：发送一个会导致 500 错误或不同长度响应的 Payload，确认该行在表格中被标记为异常。

---

## 7. 最终集成与优化
### 7.1：异常处理与重试机制
- **指令**：添加网络超时处理、AI API 错误处理及请求重试逻辑。
- **验证**：断开网络或输入错误的 API Key，确认插件弹出友好的错误提示而非崩溃。

### 7.2：打包与发布验证
- **指令**：执行混淆（可选）并打出最终的 Fat JAR。
- **验证**：在全新的 Burp Suite 环境中安装该 JAR 包，完整走通一遍“选择请求 -> AI 生成字典 -> 执行 Fuzz -> 查看结果”的流程。
